import org.apache.hadoop.conf.Configuration;
import org.apache.hadoop.fs.FileSystem;
import org.apache.hadoop.fs.Path;

public class HadoopStorageService {

    private final Configuration configuration;

    public HadoopStorageService(Configuration configuration) {
        this.configuration = configuration;
    }

    public void moveFile(String srcHdfsFilePath, String destHdfsFilePath, Integer trackId) throws IOException {
        // Create Path objects for the source and destination
        Path srcPath = new Path(srcHdfsFilePath);
        Path destPath = new Path(destHdfsFilePath);

        // Get the Hadoop filesystem
        FileSystem hdfs = FileSystem.get(configuration);

        // Check if the source file exists
        if (!hdfs.exists(srcPath)) {
            throw new FileNotFoundException("Source file not found for TrackId: " + trackId);
        }

        // Check if the destination folder exists, create if not
        if (!hdfs.exists(destPath.getParent())) {
            hdfs.mkdirs(destPath.getParent());
        }

        // Rename the source file to the destination (this effectively moves the file)
        boolean isRenamed = hdfs.rename(srcPath, destPath);

        if (!isRenamed) {
            throw new IOException("Failed to move file for TrackId: " + trackId + " from " + srcHdfsFilePath + " to " + destHdfsFilePath);
        }

        // Close the filesystem
        hdfs.close();
    }
}
